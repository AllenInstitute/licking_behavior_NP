from allensdk.internal.api import behavior_ophys_api as boa
import importlib; importlib.reload(boa)

experiment_df = boa.BehaviorOphysLimsApi.get_ophys_experiment_df()

states_to_use = ['container_qc', 'passed']

# Unique donor ids
[800311507, 789992895, 772629800, 766025752, 766015379, 788982905,
 843387577, 789014546, 830940312, 834902192, 820871399, 827778598,
 830901414, 842724844, 765991998, 803592122, 791756316, 795522266,
 791871796, 847074139, 800312319, 837628429, 813702144, 795512663,
 772622642, 834823464, 784057617, 837581576, 807248984, 847076515,
 814111925, 813703535, 830896318, 831004160, 820878203, 803258370,
 823826963, 760949537, 803582244, 722884873, 744935640, 738695281,
 756575004, 831008730, 741953980, 756577240, 744911447, 756674776,
 722884863, 623289718, 652074239, 651725149, 713968352, 710324779,
 713426152, 707282079, 710269817, 716520602, 719239251, 734705385,
 705093661, 692785809]


# First pass
# subjects_to_use = [847076515]
                   
# Second pas
# subjects_to_use = [827778598, 814111925, 813703535, 820878203, 803258370]

# Third pass
subjects_to_use = [800311507, 789992895, 772629800, 766025752, 766015379, 788982905,
 843387577, 789014546, 830940312, 834902192, 820871399, 827778598]

conditions = [
    "workflow_state in @states_to_use",
    "equipment_name != 'MESO.1'",
    "donor_id in @subjects_to_use"
]

query_string = ' and '.join(conditions)
experiments_to_use = experiment_df.query(query_string)

experiment_ids = experiments_to_use['ophys_experiment_id'].values
